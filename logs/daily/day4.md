# 开发日志 - 第4天

## 日期
2026-02-15

今天主要做性能优化、安全加固和部署配置。

先做数据库优化。给书籍表的title、author、isbn字段加了索引，这样搜索的时候会快很多。给书籍表的category_id、price字段也加了索引，这样筛选和排序的时候会快很多。给订单表的user_id、book_id字段加了索引，这样查询用户订单和订单详情的时候会快很多。

然后做缓存优化。热门书籍接口用Redis缓存，设置10分钟过期时间，这样不用每次都查数据库。分类列表接口也用Redis缓存，设置1小时过期时间，因为分类数据变化不频繁。书籍详情接口也用Redis缓存，设置5分钟过期时间，这样频繁访问同一本书的时候会快很多。

安全方面做了几个加固。密码用BCrypt加密存储，不能明文存储。SQL注入防护用MyBatis的预编译语句，不能直接拼接SQL。XSS攻击防护用Vue的自动转义，不能直接渲染用户输入的HTML。文件上传限制文件类型和大小，只能上传图片，最大5MB，防止上传恶意文件。

部署方面配置了Docker环境。后端用Dockerfile打包成镜像，基于OpenJDK 17，暴露8080端口。前端用Dockerfile打包成镜像，基于Nginx，暴露80端口。用docker-compose.yml编排前后端和MySQL，一键启动整个系统。

配置了Nginx反向代理，前端请求通过Nginx转发到后端，这样不用暴露后端端口。配置了SSL证书，支持HTTPS访问，保证数据传输安全。配置了静态资源缓存，图片、CSS、JS这些静态资源缓存1天，减少带宽消耗。

文档方面完善了API文档，用Swagger自动生成，方便前端查看接口。编写了部署文档，详细说明了如何配置环境、如何启动服务、如何配置Nginx。编写了运维手册，说明了如何监控服务、如何备份数据、如何处理常见问题。

今天遇到的问题是Redis连接超时，缓存接口偶尔失败。查了一下，发现是Redis连接池配置太小，并发请求多的时候连接不够用。最后把连接池大小从10改到100，最大空闲连接从5改到20，就解决了。

还有一个问题是Docker容器启动慢，特别是后端容器。查了一下，发现是Spring Boot启动的时候加载了很多不必要的依赖。最后在pom.xml里排除了不需要的依赖，启动时间从30秒降到10秒。

项目现在已经完成了所有核心功能开发，包括用户认证、书籍管理、订单管理、收藏管理这些。测试覆盖率达到了90%，单元测试和集成测试都通过了。性能指标也达标了，接口响应时间都在100ms以内，数据库查询时间都在50ms以内。安全方面也做了加固，密码加密、SQL注入防护、XSS防护、文件上传限制都实现了。

项目可以正式上线了，后续可以考虑添加更多功能，比如消息通知、评价点赞、书籍推荐算法这些。性能也可以持续优化，比如添加CDN加速、数据库读写分离、微服务架构这些。用户反馈也要收集，根据用户需求不断改进产品。
