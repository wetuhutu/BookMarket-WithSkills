# 开发日志 - 第2天

## 日期
2026-02-02

今天主要做核心功能开发，先把用户认证模块搞定。

用户注册接口需要接收用户名、手机号、邮箱、密码这些信息，密码用BCrypt加密后存到数据库。登录接口验证用户名和密码，验证通过后生成JWT token返回给前端。JWT用HS256算法，设置过期时间为24小时。

然后写了JWT拦截器，拦截所有需要认证的请求，从请求头里获取token，解析出用户ID存到ThreadLocal里，这样后面的业务代码就能直接获取当前登录用户的信息了。

书籍管理模块实现了几个接口：获取分类列表、获取热门书籍、获取书籍列表、获取书籍详情、获取相似书籍推荐。获取分类列表用group by统计每个分类的书籍数量。获取热门书籍用窗口函数统计每本书的销售数量，按销量排序。获取书籍列表支持分页、搜索、筛选、排序，用MyBatis的动态SQL实现。

订单管理模块实现了创建订单、确认收货、取消订单这几个接口。创建订单的时候需要检查库存，库存足够就扣减库存并创建订单记录。确认收货和取消订单就是更新订单状态。

收藏管理模块实现了获取收藏列表、添加收藏、取消收藏这几个接口。收藏表存用户ID和书籍ID，添加收藏的时候检查是否已经收藏过，避免重复收藏。

今天遇到的问题是JWT token生成的时候报错，提示密钥长度不够。查了一下，HS256算法要求密钥至少256位。最后改用更长的密钥字符串就解决了。

还有一个问题是获取热门书籍的时候，同一个书名有多本书，需要去重。用窗口函数FIRST_VALUE按书名和作者分组，取ID最大的那本书，这样就解决了重复的问题。

明天打算开始做前端页面，先做登录注册页面和首页。
