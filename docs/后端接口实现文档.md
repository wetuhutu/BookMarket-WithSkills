# 后端接口实现文档

## 文档说明

本文档详细描述了前端需要的四类后端接口，包括请求方法、路径、参数、响应示例等。

**前端技术栈**: Vue 3 + Vue Router + Tailwind CSS  
**后端技术栈**: Spring Boot + MyBatis + MySQL  
**后端地址**: http://localhost:8080/api

---

## 一、用户管理接口

### 1.1 获取用户信息

**接口描述**: 获取当前登录用户的详细信息

**请求信息**:
```http
GET /users/profile
Headers:
  Authorization: Bearer {token}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 14,
    "username": "newuser",
    "phone": "13900139999",
    "email": "new@example.com",
    "avatar": "https://example.com/avatar.jpg",
    "level": "普通会员",
    "points": 100,
    "isSeller": 1,
    "sellerLevel": "金牌卖家",
    "sellerRating": 4.8,
    "sellerIsVerified": 1,
    "sellerDescription": "诚信卖家，书籍成色好",
    "sellerPositiveRate": 98.5,
    "sellerSalesCount": 50,
    "createdAt": "2026-02-03T00:28:47.000+00:00",
    "updatedAt": "2026-02-03T00:28:47.000+00:00"
  }
}
```

**前端使用场景**:
- 个人中心页面显示用户信息
- 显示用户头像、等级、积分等
- 显示卖家信息（如果用户是卖家）

### 1.2 更新用户信息

**接口描述**: 更新当前登录用户的信息

**请求信息**:
```http
PUT /users/profile
Headers:
  Authorization: Bearer {token}
  Content-Type: application/json
Body:
{
  "username": "newuser",
  "email": "newemail@example.com",
  "avatar": "https://example.com/new-avatar.jpg",
  "sellerDescription": "诚信卖家，书籍成色好"
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": {
    "id": 14,
    "username": "newuser",
    "phone": "13900139999",
    "email": "newemail@example.com",
    "avatar": "https://example.com/new-avatar.jpg",
    ...
  }
}
```

**前端使用场景**:
- 用户修改个人信息
- 用户上传头像
- 卖家修改卖家描述

### 1.3 获取我的书籍

**接口描述**: 获取当前用户发布的书籍列表

**请求信息**:
```http
GET /users/books?page=1&pageSize=10&status=1
Headers:
  Authorization: Bearer {token}
```

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | Integer | 否 | 页码，默认1 |
| pageSize | Integer | 否 | 每页数量，默认10 |
| status | Integer | 否 | 状态：1-在售，0-下架 |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "title": "高等数学",
        "author": "同济大学数学系",
        "cover": "https://example.com/cover.jpg",
        "price": 35.00,
        "originalPrice": 68.00,
        "condition": "九成新",
        "stock": 1,
        "status": 1,
        "categoryId": "textbook",
        "createdAt": "2026-02-03T00:28:47.000+00:00"
      }
    ],
    "total": 5,
    "page": 1,
    "pageSize": 10
  }
}
```

**前端使用场景**:
- 个人中心"我的书籍"页面
- 显示用户发布的所有书籍
- 支持分页和状态筛选

### 1.4 获取我的订单

**接口描述**: 获取当前用户的订单列表

**请求信息**:
```http
GET /users/orders?page=1&pageSize=10&status=pending
Headers:
  Authorization: Bearer {token}
```

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | Integer | 否 | 页码，默认1 |
| pageSize | Integer | 否 | 每页数量，默认10 |
| status | String | 否 | 订单状态：pending-待付款，paid-待发货，shipped-已发货，received-已收货，cancelled-已取消 |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "orderNo": "ORD20260203001",
        "bookId": 1,
        "bookTitle": "高等数学",
        "bookCover": "https://example.com/cover.jpg",
        "bookPrice": 35.00,
        "quantity": 1,
        "totalPrice": 35.00,
        "sellerId": 2,
        "sellerName": "seller_001",
        "status": "paid",
        "paymentStatus": "paid",
        "shippingStatus": "unshipped",
        "createdAt": "2026-02-03T10:30:00.000+00:00",
        "paidAt": "2026-02-03T10:31:00.000+00:00"
      }
    ],
    "total": 3,
    "page": 1,
    "pageSize": 10
  }
}
```

**前端使用场景**:
- 个人中心"我的订单"页面
- 显示用户的所有订单
- 支持分页和状态筛选

### 1.5 收藏管理

#### 1.5.1 获取收藏列表

**接口描述**: 获取当前用户的收藏列表

**请求信息**:
```http
GET /users/favorites?page=1&pageSize=10
Headers:
  Authorization: Bearer {token}
```

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | Integer | 否 | 页码，默认1 |
| pageSize | Integer | 否 | 每页数量，默认10 |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "bookId": 1,
        "book": {
          "id": 1,
          "title": "高等数学",
          "author": "同济大学数学系",
          "cover": "https://example.com/cover.jpg",
          "price": 35.00,
          "originalPrice": 68.00,
          "condition": "九成新",
          "categoryId": "textbook"
        },
        "createdAt": "2026-02-03T10:30:00.000+00:00"
      }
    ],
    "total": 5,
    "page": 1,
    "pageSize": 10
  }
}
```

#### 1.5.2 添加收藏

**接口描述**: 添加书籍到收藏

**请求信息**:
```http
POST /users/favorites
Headers:
  Authorization: Bearer {token}
  Content-Type: application/json
Body:
{
  "bookId": 1
}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "收藏成功",
  "data": null
}
```

#### 1.5.3 取消收藏

**接口描述**: 取消书籍收藏

**请求信息**:
```http
DELETE /users/favorites/{bookId}
Headers:
  Authorization: Bearer {token}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "取消收藏成功",
  "data": null
}
```

**前端使用场景**:
- 个人中心"我的收藏"页面
- 书籍详情页添加/取消收藏
- 显示收藏列表

---

## 二、书籍发布接口

### 2.1 创建书籍

**接口描述**: 用户发布新书籍

**请求信息**:
```http
POST /users/books
Headers:
  Authorization: Bearer {token}
  Content-Type: application/json
Body:
{
  "title": "高等数学（第七版）上册",
  "author": "同济大学数学系",
  "isbn": "9787040396638",
  "publisher": "高等教育出版社",
  "publishDate": "2014-07",
  "pages": 368,
  "categoryId": "textbook",
  "condition": "九成新",
  "price": 35.00,
  "originalPrice": 68.00,
  "stock": 1,
  "cover": "https://example.com/cover.jpg",
  "images": [
    "https://example.com/image1.jpg",
    "https://example.com/image2.jpg",
    "https://example.com/image3.jpg"
  ],
  "description": "本书是同济大学数学系编《高等数学》第七版上册..."
}
```

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| title | String | 是 | 书籍标题 |
| author | String | 是 | 作者 |
| isbn | String | 否 | ISBN编号 |
| publisher | String | 否 | 出版社 |
| publishDate | String | 否 | 出版时间（格式：yyyy-MM） |
| pages | Integer | 否 | 页数 |
| categoryId | String | 是 | 分类ID（如：textbook, novel等） |
| condition | String | 是 | 新旧程度（全新、九成新、八成新、七成新、六成新） |
| price | Decimal | 是 | 售价 |
| originalPrice | Decimal | 否 | 原价 |
| stock | Integer | 是 | 库存数量 |
| cover | String | 是 | 封面图片URL |
| images | Array | 否 | 书籍图片数组 |
| description | String | 否 | 书籍描述 |

**响应示例**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "title": "高等数学（第七版）上册",
    "author": "同济大学数学系",
    "isbn": "9787040396638",
    "publisher": "高等教育出版社",
    "publishDate": "2014-07",
    "pages": 368,
    "categoryId": "textbook",
    "condition": "九成新",
    "price": 35,
    "originalPrice": 68,
    "stock": 1,
    "cover": "https://example.com/cover.jpg",
    "images": [
      "https://example.com/image1.jpg",
      "https://example.com/image2.jpg",
      "https://example.com/image3.jpg"
    ],
    "description": "本书是同济大学数学系编《高等数学》第七版上册...",
    "sellerId": 14,
    "status": 1,
    "createdAt": "2026-02-03T15:30:00.000+00:00",
    "updatedAt": "2026-02-03T15:30:00.000+00:00"
  }
}
```

**前端使用场景**:
- 发布书籍页面（Publish.vue）
- 用户填写书籍信息并发布
- 表单验证和数据提交

### 2.2 文件上传接口

**接口描述**: 上传书籍图片

**请求信息**:
```http
POST /upload
Headers:
  Authorization: Bearer {token}
  Content-Type: multipart/form-data
Body:
  file: [二进制文件数据]
```

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| file | File | 是 | 图片文件（支持jpg, png, gif等格式） |
| type | String | 否 | 文件类型（cover, image） |

**响应示例**:
```json
{
  "code": 200,
  "message": "上传成功",
  "data": "https://ws-bookmarket.oss-cn-wuhan-lr.aliyuncs.com/images/1770308512581_5f11f441.png"
}
```

**前端使用场景**:
- 发布书籍时上传封面图片
- 发布书籍时上传多张书籍图片
- 用户头像上传

---

## 三、订单管理接口

### 3.1 创建订单

**接口描述**: 用户购买书籍，创建订单

**请求信息**:
```http
POST /orders
Headers:
  Authorization: Bearer {token}
  Content-Type: application/json
Body:
{
  "bookId": 1,
  "quantity": 1,
  "sellerId": 2
}
```

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| bookId | Long | 是 | 书籍ID |
| quantity | Integer | 是 | 购买数量，默认1 |
| sellerId | Long | 是 | 卖家ID |

**响应示例**:
```json
{
  "code": 200,
  "message": "订单创建成功",
  "data": {
    "id": 1,
    "orderNo": "ORD20260203001",
    "buyerId": 14,
    "sellerId": 2,
    "bookId": 1,
    "bookTitle": "高等数学",
    "bookCover": "https://example.com/cover.jpg",
    "bookPrice": 35.00,
    "quantity": 1,
    "totalPrice": 35.00,
    "status": "pending",
    "paymentStatus": "unpaid",
    "shippingStatus": "unshipped",
  }
}
```

**前端使用场景**:
- 书籍详情页点击"立即购买"
- 确认订单信息
- 创建订单并跳转到支付页面

### 3.2 确认收货

**接口描述**: 买家确认收到货物

**请求信息**:
```http
PUT /orders/{orderId}/confirm
Headers:
  Authorization: Bearer {token}
```

**响应示例**:
```json
{
  "code": 200,
  "message": "确认收货成功",
  "data": {
    "id": 1,
    "orderNo": "ORD20260203001",
    "status": "received",
    "shippingStatus": "received",
    "receivedAt": "2026-02-03T16:30:00.000+00:00"
  }
}
```

**前端使用场景**:
- 订单详情页
- 订单状态为"已发货"时显示"确认收货"按钮
- 用户点击确认收货

### 3.3 取消订单

**接口描述**: 买家取消未发货的订单

**请求信息**:
```http
PUT /orders/{orderId}/cancel
Headers:
  Authorization: Bearer {token}
Body:
{
  "reason": "不想要了"
}
```

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| reason | String | 否 | 取消原因 |

**响应示例**:
```json
{
  "code": 200,
  "message": "订单已取消",
  "data": {
    "id": 1,
    "orderNo": "ORD20260203001",
    "status": "cancelled",
    "cancelledAt": "2026-02-03T16:30:00.000+00:00"
  }
}
```

**前端使用场景**:
- 订单详情页
- 订单状态为"待付款"或"待发货"时显示"取消订单"按钮
- 用户填写取消原因并提交

---


## 五、通用说明

### 5.1 认证说明

所有需要用户认证的接口都需要在请求头中携带 JWT token：

```http
Authorization: Bearer {token}
```

**Token 获取方式**:
- 登录接口返回：`POST /auth/login`
- 注册接口返回：`POST /auth/register`
- 存储位置：`localStorage.getItem('token')`

### 5.2 分页说明

所有列表接口都支持分页，使用统一的分页参数：

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|---------|------|
| page | Integer | 1 | 当前页码 |
| pageSize | Integer | 10 | 每页数量 |

**响应格式**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [...],
    "total": 100,
    "page": 1,
    "pageSize": 10
  }
}
```

### 5.3 错误码说明

| 错误码 | 说明 |
|--------|------|
| 200 | 成功 |
| 0 | 业务错误（如：手机号已存在、库存不足等） |
| 401 | 未认证（token无效或过期） |
| 403 | 无权限 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

### 5.4 响应格式说明

所有接口都使用统一的响应格式：

```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

**字段说明**:
- `code`: 状态码，200表示成功
- `message`: 提示信息
- `data`: 返回的数据，可能为null

---

## 六、前端实现建议

### 6.1 API 封装

在 `src/api/index.js` 中添加这些接口：

```javascript
// 用户管理
export const getUserProfile = () => request.get('/users/profile')
export const updateUserProfile = (data) => request.put('/users/profile', data)
export const getMyBooks = (params) => request.get('/users/books', { params })
export const getMyOrders = (params) => request.get('/users/orders', { params })
export const getFavorites = (params) => request.get('/users/favorites', { params })
export const addFavorite = (bookId) => request.post('/users/favorites', { bookId })
export const removeFavorite = (bookId) => request.delete(`/users/favorites/${bookId}`)
export const checkFavorite = (bookId) => request.get('/users/favorites/check', { params: { bookId } })

// 书籍发布
export const createBook = (data) => request.post('/books', data)
export const uploadFile = (file, type) => {
  const formData = new FormData()
  formData.append('file', file)
  formData.append('type', type)
  return request.post('/upload', formData, {
    headers: { 'Content-Type': 'multipart/form-data' }
  })
}

// 订单管理
export const createOrder = (data) => request.post('/orders', data)
export const confirmOrder = (orderId) => request.put(`/orders/${orderId}/confirm`)
export const cancelOrder = (orderId, reason) => request.put(`/orders/${orderId}/cancel`, { reason })

// 收藏管理
export const addFavorite = (bookId) => request.post('/favorites', { bookId })
export const removeFavorite = (bookId) => request.delete(`/favorites/${bookId}`)
export const checkFavorite = (bookId) => request.get('/favorites/check', { params: { bookId } })
```

### 6.2 路由守卫

在 `src/router/index.js` 中添加路由守卫：

```javascript
router.beforeEach((to, from, next) => {
  const token = localStorage.getItem('token')
  
  if (to.meta.requiresAuth && !token) {
    next('/login')
  } else if (to.path === '/login' && token) {
    next('/')
  } else {
    next()
  }
})
```

### 6.3 状态管理

建议使用 Pinia 进行全局状态管理：

```javascript
// stores/user.js
import { defineStore } from 'pinia'

export const useUserStore = defineStore('user', {
  state: () => ({
    isLoggedIn: false,
    user: null,
    token: null
  }),
  actions: {
    setUser(user, token) {
      this.user = user
      this.token = token
      this.isLoggedIn = !!token
      localStorage.setItem('user', JSON.stringify(user))
      localStorage.setItem('token', token)
    },
    clearUser() {
      this.user = null
      this.token = null
      this.isLoggedIn = false
      localStorage.removeItem('user')
      localStorage.removeItem('token')
    }
  }
})
```

---

## 七、测试用例

### 7.1 用户管理接口测试

| 测试项 | 接口 | 预期结果 |
|--------|------|---------|
| 获取用户信息 | GET /users/profile | 返回用户详细信息 |
| 更新用户信息 | PUT /users/profile | 更新成功 |
| 获取我的书籍 | GET /users/books | 返回书籍列表 |
| 获取我的订单 | GET /users/orders | 返回订单列表 |
| 获取收藏列表 | GET /users/favorites | 返回收藏列表 |
| 添加收藏 | POST /users/favorites | 添加成功 |
| 取消收藏 | DELETE /users/favorites/{bookId} | 取消成功 |

### 7.2 书籍发布接口测试

| 测试项 | 接口 | 预期结果 |
|--------|------|---------|
| 创建书籍 | POST /books | 创建成功，返回书籍ID |
| 上传图片 | POST /upload | 返回图片URL |

### 7.3 订单管理接口测试

| 测试项 | 接口 | 预期结果 |
|--------|------|---------|
| 创建订单 | POST /orders | 创建成功，返回订单号 |
| 确认收货 | PUT /orders/{id}/confirm | 状态更新为已收货 |
| 取消订单 | PUT /orders/{id}/cancel | 状态更新为已取消 |

---

## 八、注意事项

### 8.1 安全性

1. **Token 验证**: 所有需要认证的接口都要验证 JWT token 的有效性
2. **权限控制**: 用户只能操作自己的数据（自己的书籍、订单、收藏）
3. **数据验证**: 所有输入参数都要进行验证，防止SQL注入和XSS攻击
4. **文件上传**: 限制文件大小和类型，防止恶意文件上传

### 8.2 性能优化

1. **分页查询**: 所有列表接口都支持分页，避免一次性返回大量数据
2. **图片压缩**: 上传的图片应该进行压缩，减少带宽占用
3. **缓存策略**: 常用数据（如分类、热门书籍）可以使用缓存
4. **数据库索引**: 为常用查询字段添加索引，提高查询速度

### 8.3 用户体验

1. **错误提示**: 所有错误都要返回清晰的错误信息
2. **加载状态**: 长时间操作要显示loading状态
3. **成功提示**: 操作成功后要显示成功提示
4. **表单验证**: 前端要进行表单验证，减少无效请求

---

## 九、总结

本文档详细描述了四类后端接口：

1. **用户管理接口**: 7个接口
   - 获取/更新用户信息
   - 获取我的书籍
   - 获取我的订单
   - 收藏管理（获取、添加、取消）

2. **书籍发布接口**: 2个接口
   - 创建书籍
   - 文件上传

3. **订单管理接口**: 3个接口
   - 创建订单
   - 确认收货
   - 取消订单

4. **收藏管理接口**: 3个接口
   - 添加收藏
   - 取消收藏
   - 检查收藏状态

**总计**: 15个接口

这些接口覆盖了前端的所有核心功能需求，实现后可以完整支持前端的所有业务场景。
